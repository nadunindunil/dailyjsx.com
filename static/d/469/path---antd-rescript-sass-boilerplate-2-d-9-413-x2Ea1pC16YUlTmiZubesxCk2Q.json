{"data":{"site":{"siteMetadata":{"title":"DailyJSX","author":"Nadun Indunil"}},"markdownRemark":{"id":"d1f733b7-a5e8-58b4-ae7c-669cbec57d1c","html":"<p>This episode I am going to describe how to use rescripts to override create-react-app webpack configuration to work with ant design ntd-scss-theme-plugin. Even though <a href=\"https://ant.design/docs/react/use-with-create-react-app\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">antd</a> and <a href=\"https://github.com/intoli/antd-scss-theme-plugin\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">antd-scss-theme-plugin</a> provide somewhat documentation to override CRA webpack I couldnâ€™t find a way to run the application.</p>\n<blockquote>\n<p>TL;DR here is the boilerplate url : <a href=\"https://github.com/nadunindunil/antd-rescripts-boilerplate\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/nadunindunil/antd-rescripts-boilerplate</a></p>\n</blockquote>\n<h3 id=\"lets-start-installing-dependencies\"><a href=\"#lets-start-installing-dependencies\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Lets start installing dependencies:</h3>\n<p>Install these as dev dependencies:</p>\n<ul>\n<li>@rescripts/cli</li>\n<li>@rescripts/rescript-use-babel-config</li>\n<li>antd-scss-theme-plugin</li>\n<li>babel-plugin-import0</li>\n<li>less</li>\n<li>less-loader</li>\n</ul>\n<p>Install antd as npm dependency.</p>\n<p>change <strong><em>package.json</em></strong> scripts section to this:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"start-old\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"react-scripts start\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"build-old\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"react-scripts build\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"test-old\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"react-scripts test --env=jsdom\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"start\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"rescripts start\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"rescripts build\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"rescripts test\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"eject\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"react-scripts eject\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>then add theme.scss file inside src folder with a styling like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"scss\"><pre class=\"language-scss\"><code class=\"language-scss\"><span class=\"token property\"><span class=\"token variable\">$primary-color</span></span><span class=\"token punctuation\">:</span> #fe8019<span class=\"token punctuation\">;</span></code></pre></div>\n<p>finally add .rescriptsrc.js into project root:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> AntdScssThemePlugin <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'antd-scss-theme-plugin'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">addLessLoader</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>loaderOptions <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> config <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> mode <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">===</span> <span class=\"token string\">'development'</span> <span class=\"token operator\">?</span> <span class=\"token string\">'dev'</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">'prod'</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Need these for production mode, which are copied from react-scripts</span>\n  <span class=\"token keyword\">const</span> publicPath <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'react-scripts/config/paths'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>servedPath<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> shouldUseRelativeAssetPaths <span class=\"token operator\">=</span> publicPath <span class=\"token operator\">===</span> <span class=\"token string\">'./'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> shouldUseSourceMap <span class=\"token operator\">=</span> mode <span class=\"token operator\">===</span> <span class=\"token string\">'prod'</span> <span class=\"token operator\">&amp;&amp;</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">GENERATE_SOURCEMAP</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'false'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> lessRegex <span class=\"token operator\">=</span> <span class=\"token regex\">/\\.less$/</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> lessModuleRegex <span class=\"token operator\">=</span> <span class=\"token regex\">/\\.module\\.less$/</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> localIdentName <span class=\"token operator\">=</span> loaderOptions<span class=\"token punctuation\">.</span>localIdentName <span class=\"token operator\">||</span> <span class=\"token string\">'[path][name]__[local]--[hash:base64:5]'</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getLessLoader</span> <span class=\"token operator\">=</span> cssOptions <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>\n      mode <span class=\"token operator\">===</span> <span class=\"token string\">'dev'</span>\n        <span class=\"token operator\">?</span> require<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'style-loader'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n            loader<span class=\"token punctuation\">:</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mini-css-extract-plugin'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>loader<span class=\"token punctuation\">,</span>\n            options<span class=\"token punctuation\">:</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> shouldUseRelativeAssetPaths <span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span> publicPath<span class=\"token punctuation\">:</span> <span class=\"token string\">'../../'</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">:</span> undefined<span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        loader<span class=\"token punctuation\">:</span> require<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'css-loader'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        options<span class=\"token punctuation\">:</span> cssOptions\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        loader<span class=\"token punctuation\">:</span> require<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'postcss-loader'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n          ident<span class=\"token punctuation\">:</span> <span class=\"token string\">'postcss'</span><span class=\"token punctuation\">,</span>\n          plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span>\n            <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'postcss-flexbugs-fixes'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'postcss-preset-env'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n              autoprefixer<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n                flexbox<span class=\"token punctuation\">:</span> <span class=\"token string\">'no-2009'</span>\n              <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n              stage<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n          sourceMap<span class=\"token punctuation\">:</span> shouldUseSourceMap\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        loader<span class=\"token punctuation\">:</span> <span class=\"token string\">'sass-loader'</span><span class=\"token punctuation\">,</span>\n        options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n          sourceMap<span class=\"token punctuation\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      AntdScssThemePlugin<span class=\"token punctuation\">.</span><span class=\"token function\">themify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        loader<span class=\"token punctuation\">:</span> <span class=\"token string\">'less-loader'</span><span class=\"token punctuation\">,</span>\n        options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n          javascriptEnabled<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n          sourceMap<span class=\"token punctuation\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> loaders <span class=\"token operator\">=</span> config<span class=\"token punctuation\">.</span>module<span class=\"token punctuation\">.</span>rules<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span>rule <span class=\"token operator\">=></span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">isArray</span><span class=\"token punctuation\">(</span>rule<span class=\"token punctuation\">.</span>oneOf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>oneOf<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Insert less-loader as the penultimate item of loaders (before file-loader)</span>\n  loaders<span class=\"token punctuation\">.</span><span class=\"token function\">splice</span><span class=\"token punctuation\">(</span>\n    loaders<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      test<span class=\"token punctuation\">:</span> lessRegex<span class=\"token punctuation\">,</span>\n      exclude<span class=\"token punctuation\">:</span> lessModuleRegex<span class=\"token punctuation\">,</span>\n      use<span class=\"token punctuation\">:</span> <span class=\"token function\">getLessLoader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        importLoaders<span class=\"token punctuation\">:</span> <span class=\"token number\">2</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      sideEffects<span class=\"token punctuation\">:</span> mode <span class=\"token operator\">===</span> <span class=\"token string\">'prod'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      test<span class=\"token punctuation\">:</span> lessModuleRegex<span class=\"token punctuation\">,</span>\n      use<span class=\"token punctuation\">:</span> <span class=\"token function\">getLessLoader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        importLoaders<span class=\"token punctuation\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n        modules<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        localIdentName<span class=\"token punctuation\">:</span> localIdentName\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> config<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    webpack<span class=\"token punctuation\">:</span> config <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      config<span class=\"token punctuation\">.</span>resolve<span class=\"token punctuation\">.</span>extensions <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>config<span class=\"token punctuation\">.</span>resolve<span class=\"token punctuation\">.</span>extensions<span class=\"token punctuation\">,</span> <span class=\"token string\">'.less'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// change next line location as you want to add custom scss file</span>\n      config<span class=\"token punctuation\">.</span>plugins <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>config<span class=\"token punctuation\">.</span>plugins<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AntdScssThemePlugin</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./src/theme.scss'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n      config <span class=\"token operator\">=</span> <span class=\"token function\">addLessLoader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">return</span> config<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'use-babel-config'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      presets<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'react-app'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">[</span>\n          <span class=\"token string\">'import'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">{</span>\n            libraryName<span class=\"token punctuation\">:</span> <span class=\"token string\">'antd'</span><span class=\"token punctuation\">,</span>\n            style<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>I hope this will help you to configure your next react application using antd.</p>","timeToRead":2,"frontmatter":{"title":"Ant Design Webpack override","date":"August 06, 2019","spoiler":"How to override webpack using rescript in CRA","author":"Nadun Indunil","tags":["react","webpack","antd"]},"fields":{"slug":"/antd-rescript-sass-boilerplate/","langKey":"en"}}},"pageContext":{"slug":"/antd-rescript-sass-boilerplate/","previous":{"fields":{"slug":"/cognito-auth-js-redirect-after-signin/","langKey":"en","directoryName":"cognito-auth-js-redirect-after-signin"},"frontmatter":{"title":"How to implement redirection to a dynamic route after signin with cognito-auth-js","tags":["React","AWS","Cognito"]}},"next":null,"translations":[],"translatedLinks":[]}}