{"data":{"site":{"siteMetadata":{"title":"DailyJSX","author":"Nadun Indunil"}},"markdownRemark":{"id":"96232beb-1fd1-5c98-80fd-8e12192eac91","html":"<h1 id=\"introduction\"><a href=\"#introduction\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h1>\n<p>Recently I had an opportunity to implement and deploy a Gatsby site with designing end to end deployment work.\nI believe most you have heard about Gatsby.js which is a javascript framework to create blazing fast static websites. In this article, I am not going to explain about Gatsby.js. In fact, This article doesnâ€™t talk about Gatsby.js at all. I will explain how I deployed this static website into AWS S3 and Amazon Cloudfront using the AWS code pipeline.</p>\n<h1 id=\"architecture\"><a href=\"#architecture\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Architecture</h1>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/320f9b5b5f261f4e337315a2aa9dc93d/094a0/deployment.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 53.838582677165356%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAB+klEQVQoz21Sz0sbURDev6d/gAdvBcF6KLRCQYQ2hIiHkotQW4RWBCupLUlpqYrgRVoKHlptahU1goIH7Q+1xqa2DTFN1GzQuM2P3ewm2f365u2+TQwODG/ezHzfzLw3UjKVhvIvj3yhiGq1imJJRVnXUauZTGu2WpatzDbZmT7JIKcoHKcbBjStDFXVeFwCk9HnE7jW6eEJ7Tfv4NmLSXLDhC2WqsIqlrhNIJJEMoXWtk58XIxgYGgUXV5/nfDDwgoCwTEUGGj46UuEFyI2OF/g5+72Hj5vfb1AmD09w6PHQezHfmHm/TxCr6Zgse4lo1LhCesbm+jxP8Dv+CG/K+cK4tEYymUd/YMB3O7ts7s2TQgMkT8JTWD67Tt7EiKsOMHI2gZ8/vuIJ5L8PvdpGVevd2PvxwG2d6NYWl13CQWmxN7Ne/ceAqFxt4BUdUY4y51j88sOVE3j9287UQyOBJE+zvAneTMz6xLS5wmJJ/5Czp7WOzQMuxoBrrS04fv+T7taQyc07o3uXpdQZ/586gg5OYuOW170PxxxMe7IsYM/GJ96jRx7OwGkiiRHJzLvVPhprTKZLAps1QgzN79UH5kSxM8J4fvm+IlUlmWuZFMXFGsW0/FLwmE5iyu6olPYPl8PPB7PBQIRb8wjkZoDjSo6CYfDXC8jatb/NtMg2dtlLbsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"architecture diagram\"\n        title=\"\"\n        src=\"/static/320f9b5b5f261f4e337315a2aa9dc93d/40fad/deployment.png\"\n        srcset=\"/static/320f9b5b5f261f4e337315a2aa9dc93d/707e9/deployment.png 148w,\n/static/320f9b5b5f261f4e337315a2aa9dc93d/649e0/deployment.png 295w,\n/static/320f9b5b5f261f4e337315a2aa9dc93d/40fad/deployment.png 590w,\n/static/320f9b5b5f261f4e337315a2aa9dc93d/b3fef/deployment.png 885w,\n/static/320f9b5b5f261f4e337315a2aa9dc93d/301c0/deployment.png 1180w,\n/static/320f9b5b5f261f4e337315a2aa9dc93d/b5a53/deployment.png 1770w,\n/static/320f9b5b5f261f4e337315a2aa9dc93d/094a0/deployment.png 2032w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>The frontend UI code will be stored in a private AWS S3 bucket. Then I am going to use a Cloudfront to distribute the hosted code in all edge locations around the globe. You can see ACM (Amazon Certificate Manager) and Route 53 which was used to provide SSL certificate and DNS management respectively. The very same architecture is used inside the Prod account as well. As you can see, we all can agree that this is a very simple architecture.</p>\n<h1 id=\"deployment\"><a href=\"#deployment\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Deployment</h1>\n<h2 id=\"pipeline-flow\"><a href=\"#pipeline-flow\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pipeline Flow</h2>\n<p>I will start the code pipeline flow from the inception.</p>\n<ol>\n<li>The pipeline will be triggered by a code change in the Github repository. (In my scenario repository is an inhouse repository. Hence, I used this method to trigger the code pipeline: <a href=\"https://aws.amazon.com/blogs/devops/integrating-git-with-aws-codepipeline/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://aws.amazon.com/blogs/devops/integrating-git-with-aws-codepipeline/</a>)</li>\n<li>Then the pipeline will automatically start the code build. The code build has the instructions to build the source code and deploy it into the dev S3 bucket.</li>\n<li>After the deployment, the pipeline will be on hold till we confirm to go ahead. This is achieved by using an approval step in the code pipeline.</li>\n<li>The final step is when we approve the manual approval. This will build the code again (This is a limitation with JS. If we have separate env variable we need to build the code again) and push it to the prod account S3 bucket.</li>\n</ol>\n<h2 id=\"cloudformation-template\"><a href=\"#cloudformation-template\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cloudformation Template</h2>\n<p>You can run this CFT from the AWS console.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">AWSTemplateFormatVersion</span><span class=\"token punctuation\">:</span> <span class=\"token datetime number\">2010-09-09</span>\n<span class=\"token key atrule\">Description</span><span class=\"token punctuation\">:</span> Cloudformation template for code pipeline\n\n<span class=\"token key atrule\">Parameters</span><span class=\"token punctuation\">:</span>\n  <span class=\"token comment\"># Tagging Params</span>\n  <span class=\"token key atrule\">ApplicationName</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Description</span><span class=\"token punctuation\">:</span> Name of application\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> String\n    <span class=\"token key atrule\">MinLength</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"1\"</span>\n    <span class=\"token key atrule\">MaxLength</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"255\"</span>\n    <span class=\"token key atrule\">AllowedPattern</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'[\\x20-\\x7E]*'</span>\n    <span class=\"token key atrule\">ConstraintDescription</span><span class=\"token punctuation\">:</span> Must contain only ASCII characters.\n  <span class=\"token comment\">#stack params</span>\n  <span class=\"token key atrule\">SourceBucketName</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Description</span><span class=\"token punctuation\">:</span> git source\n    <span class=\"token key atrule\">Default</span><span class=\"token punctuation\">:</span> git<span class=\"token punctuation\">-</span>web<span class=\"token punctuation\">-</span>hook<span class=\"token punctuation\">-</span>outputbucket\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> String\n  <span class=\"token key atrule\">DevDistributionID</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Description</span><span class=\"token punctuation\">:</span> Dev Cloudfront Distribution ID\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> String\n  <span class=\"token key atrule\">ProdDistributionID</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Description</span><span class=\"token punctuation\">:</span> Prod Cloudfront Distribution ID\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> String\n  <span class=\"token key atrule\">DevDeployBucket</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Description</span><span class=\"token punctuation\">:</span> Deploy Bucket ARN\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> String\n  <span class=\"token key atrule\">DevDeployBucketName</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Description</span><span class=\"token punctuation\">:</span> Deploy Bucket Name\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> String\n  <span class=\"token key atrule\">ProdDeployBucket</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Description</span><span class=\"token punctuation\">:</span> Deploy Bucket ARN\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> String\n  <span class=\"token key atrule\">ProdDeployBucketName</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Description</span><span class=\"token punctuation\">:</span> Deploy Bucket Name\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> String\n  <span class=\"token key atrule\">CodePipelineBucketPrefix</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Description</span><span class=\"token punctuation\">:</span> CodePipeline needs a utility bucket for its internal use. Specify a unique prefix for the bucket name\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> String\n  <span class=\"token comment\"># assume role arn</span>\n  <span class=\"token key atrule\">AssumeRoleArn</span><span class=\"token punctuation\">:</span> \n    <span class=\"token key atrule\">Description</span><span class=\"token punctuation\">:</span> Prod Assume Role ARN\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> String\n\n<span class=\"token key atrule\">Resources</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">Pipeline</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"AWS::CodePipeline::Pipeline\"</span>\n    <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">Name</span><span class=\"token punctuation\">:</span> gatsby<span class=\"token punctuation\">-</span>site<span class=\"token punctuation\">-</span>pipeline\n      <span class=\"token key atrule\">RoleArn</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!GetAtt</span> CodePipelineRole.Arn\n      <span class=\"token key atrule\">ArtifactStore</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">Location</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> PipelineBucket\n        <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> S3\n      <span class=\"token key atrule\">Stages</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Name</span><span class=\"token punctuation\">:</span> Source\n          <span class=\"token key atrule\">Actions</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Name</span><span class=\"token punctuation\">:</span> Source<span class=\"token punctuation\">-</span>Action\n              <span class=\"token key atrule\">ActionTypeId</span><span class=\"token punctuation\">:</span>\n                <span class=\"token key atrule\">Category</span><span class=\"token punctuation\">:</span> Source\n                <span class=\"token key atrule\">Owner</span><span class=\"token punctuation\">:</span> AWS\n                <span class=\"token key atrule\">Version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n                <span class=\"token key atrule\">Provider</span><span class=\"token punctuation\">:</span> S3\n              <span class=\"token key atrule\">OutputArtifacts</span><span class=\"token punctuation\">:</span>\n                <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Name</span><span class=\"token punctuation\">:</span> gatsby<span class=\"token punctuation\">-</span>site<span class=\"token punctuation\">-</span>source<span class=\"token punctuation\">-</span>artifact\n              <span class=\"token key atrule\">Configuration</span><span class=\"token punctuation\">:</span>\n                <span class=\"token key atrule\">S3Bucket</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> SourceBucketName\n                <span class=\"token key atrule\">S3ObjectKey</span><span class=\"token punctuation\">:</span> repo<span class=\"token punctuation\">-</span>name<span class=\"token punctuation\">-</span>develop.zip <span class=\"token comment\"># &lt;repo-name>-&lt;branch-name></span>\n                <span class=\"token key atrule\">PollForSourceChanges</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n              <span class=\"token key atrule\">RunOrder</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Name</span><span class=\"token punctuation\">:</span> Dev\n          <span class=\"token key atrule\">Actions</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Name</span><span class=\"token punctuation\">:</span> Deploy<span class=\"token punctuation\">-</span>Dev\n              <span class=\"token key atrule\">ActionTypeId</span><span class=\"token punctuation\">:</span>\n                <span class=\"token key atrule\">Category</span><span class=\"token punctuation\">:</span> Build\n                <span class=\"token key atrule\">Owner</span><span class=\"token punctuation\">:</span> AWS\n                <span class=\"token key atrule\">Version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n                <span class=\"token key atrule\">Provider</span><span class=\"token punctuation\">:</span> CodeBuild\n              <span class=\"token key atrule\">InputArtifacts</span><span class=\"token punctuation\">:</span>\n                <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Name</span><span class=\"token punctuation\">:</span> gatsby<span class=\"token punctuation\">-</span>site<span class=\"token punctuation\">-</span>source<span class=\"token punctuation\">-</span>artifact\n              <span class=\"token key atrule\">OutputArtifacts</span><span class=\"token punctuation\">:</span>\n                <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Name</span><span class=\"token punctuation\">:</span> gatsby<span class=\"token punctuation\">-</span>site<span class=\"token punctuation\">-</span>dev<span class=\"token punctuation\">-</span>build<span class=\"token punctuation\">-</span>artifact\n              <span class=\"token key atrule\">Configuration</span><span class=\"token punctuation\">:</span>\n                <span class=\"token key atrule\">ProjectName</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> DevCodeBuild\n              <span class=\"token key atrule\">RunOrder</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Name</span><span class=\"token punctuation\">:</span> Prod\n          <span class=\"token key atrule\">Actions</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Name</span><span class=\"token punctuation\">:</span> Deploy<span class=\"token punctuation\">-</span>Prod<span class=\"token punctuation\">-</span>Approval\n              <span class=\"token key atrule\">ActionTypeId</span><span class=\"token punctuation\">:</span>\n                <span class=\"token key atrule\">Category</span><span class=\"token punctuation\">:</span> Approval\n                <span class=\"token key atrule\">Owner</span><span class=\"token punctuation\">:</span> AWS\n                <span class=\"token key atrule\">Provider</span><span class=\"token punctuation\">:</span> Manual\n                <span class=\"token key atrule\">Version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"1\"</span>\n              <span class=\"token key atrule\">RunOrder</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Name</span><span class=\"token punctuation\">:</span> Deploy<span class=\"token punctuation\">-</span>Prod\n              <span class=\"token key atrule\">ActionTypeId</span><span class=\"token punctuation\">:</span>\n                <span class=\"token key atrule\">Category</span><span class=\"token punctuation\">:</span> Build\n                <span class=\"token key atrule\">Owner</span><span class=\"token punctuation\">:</span> AWS\n                <span class=\"token key atrule\">Version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n                <span class=\"token key atrule\">Provider</span><span class=\"token punctuation\">:</span> CodeBuild\n              <span class=\"token key atrule\">InputArtifacts</span><span class=\"token punctuation\">:</span>\n                <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Name</span><span class=\"token punctuation\">:</span> gatsby<span class=\"token punctuation\">-</span>site<span class=\"token punctuation\">-</span>source<span class=\"token punctuation\">-</span>artifact\n              <span class=\"token key atrule\">OutputArtifacts</span><span class=\"token punctuation\">:</span>\n                <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Name</span><span class=\"token punctuation\">:</span> gatsby<span class=\"token punctuation\">-</span>site<span class=\"token punctuation\">-</span>prod<span class=\"token punctuation\">-</span>build<span class=\"token punctuation\">-</span>artifact\n              <span class=\"token key atrule\">Configuration</span><span class=\"token punctuation\">:</span>\n                <span class=\"token key atrule\">ProjectName</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> ProdCodeBuild\n              <span class=\"token key atrule\">RunOrder</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span>\n  <span class=\"token key atrule\">CodeBuildRole</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>IAM<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Role\n    <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">RoleName</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">\"Fn::Join\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"CodeBuildRole\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"-\"</span><span class=\"token punctuation\">,</span> <span class=\"token tag\">!Ref</span> <span class=\"token string\">\"AWS::StackName\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n      <span class=\"token key atrule\">AssumeRolePolicyDocument</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">Version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2012-10-17\"</span>\n        <span class=\"token key atrule\">Statement</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Effect</span><span class=\"token punctuation\">:</span> Allow\n            <span class=\"token key atrule\">Principal</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">Service</span><span class=\"token punctuation\">:</span>\n                <span class=\"token punctuation\">-</span> <span class=\"token string\">\"codebuild.amazonaws.com\"</span>\n            <span class=\"token key atrule\">Action</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token string\">\"sts:AssumeRole\"</span>\n      <span class=\"token key atrule\">Path</span><span class=\"token punctuation\">:</span> /service<span class=\"token punctuation\">-</span>role/\n      <span class=\"token key atrule\">Policies</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">PolicyName</span><span class=\"token punctuation\">:</span> root\n          <span class=\"token key atrule\">PolicyDocument</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">Version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2012-10-17\"</span>\n            <span class=\"token key atrule\">Statement</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Effect</span><span class=\"token punctuation\">:</span> Allow\n                <span class=\"token key atrule\">Action</span><span class=\"token punctuation\">:</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"s3:GetObject\"</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"s3:GetObjectVersion\"</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"s3:GetBucketVersioning\"</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"s3:PutObject\"</span>\n                <span class=\"token key atrule\">Resource</span><span class=\"token punctuation\">:</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token tag\">!GetAtt</span> PipelineBucket.Arn\n                  <span class=\"token punctuation\">-</span> <span class=\"token tag\">!Join</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token tag\">!GetAtt</span> PipelineBucket.Arn<span class=\"token punctuation\">,</span> <span class=\"token string\">\"/*\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Effect</span><span class=\"token punctuation\">:</span> Allow\n                <span class=\"token key atrule\">Action</span><span class=\"token punctuation\">:</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"s3:ListAllMyBuckets\"</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"s3:ListBucket\"</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"s3:HeadBucket\"</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"s3:GetObject\"</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"s3:GetObjectVersion\"</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"s3:GetBucketVersioning\"</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"s3:PutObject\"</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"s3:PutObjectAcl\"</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"s3:DeleteObject\"</span>\n                <span class=\"token key atrule\">Resource</span><span class=\"token punctuation\">:</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token tag\">!Ref</span> DevDeployBucket\n                  <span class=\"token punctuation\">-</span> <span class=\"token tag\">!Join</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token tag\">!Ref</span> DevDeployBucket<span class=\"token punctuation\">,</span> <span class=\"token string\">\"/*\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Effect</span><span class=\"token punctuation\">:</span> Allow\n                <span class=\"token key atrule\">Action</span><span class=\"token punctuation\">:</span>\n                  <span class=\"token punctuation\">-</span> ec2<span class=\"token punctuation\">:</span>DescribeSecurityGroups\n                  <span class=\"token punctuation\">-</span> ec2<span class=\"token punctuation\">:</span>DescribeNetworkInterfaces\n                  <span class=\"token punctuation\">-</span> ec2<span class=\"token punctuation\">:</span>DescribeSubnets\n                  <span class=\"token punctuation\">-</span> ec2<span class=\"token punctuation\">:</span>DescribeVpcs\n                  <span class=\"token punctuation\">-</span> ec2<span class=\"token punctuation\">:</span>DescribeDhcpOptions\n                  <span class=\"token punctuation\">-</span> ec2<span class=\"token punctuation\">:</span>CreateNetworkInterfacePermission\n                  <span class=\"token punctuation\">-</span> ec2<span class=\"token punctuation\">:</span>CreateNetworkInterface\n                  <span class=\"token punctuation\">-</span> ec2<span class=\"token punctuation\">:</span>DeleteNetworkInterfacePermission\n                  <span class=\"token punctuation\">-</span> ec2<span class=\"token punctuation\">:</span>DeleteNetworkInterface\n                  <span class=\"token punctuation\">-</span> logs<span class=\"token punctuation\">:</span>CreateLogGroup\n                  <span class=\"token punctuation\">-</span> logs<span class=\"token punctuation\">:</span>CreateLogStream\n                  <span class=\"token punctuation\">-</span> logs<span class=\"token punctuation\">:</span>PutLogEvents\n                  <span class=\"token punctuation\">-</span> cloudfront<span class=\"token punctuation\">:</span>CreateInvalidation\n                <span class=\"token key atrule\">Resource</span><span class=\"token punctuation\">:</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"*\"</span>\n  <span class=\"token key atrule\">ProdCodeBuildRole</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>IAM<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Role\n    <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">RoleName</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">\"Fn::Join\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"CodeBuildRole-Prod\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"-\"</span><span class=\"token punctuation\">,</span> <span class=\"token tag\">!Ref</span> <span class=\"token string\">\"AWS::StackName\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n      <span class=\"token key atrule\">AssumeRolePolicyDocument</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">Version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2012-10-17\"</span>\n        <span class=\"token key atrule\">Statement</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Effect</span><span class=\"token punctuation\">:</span> Allow\n            <span class=\"token key atrule\">Principal</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">Service</span><span class=\"token punctuation\">:</span>\n                <span class=\"token punctuation\">-</span> <span class=\"token string\">\"codebuild.amazonaws.com\"</span>\n            <span class=\"token key atrule\">Action</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token string\">\"sts:AssumeRole\"</span>\n      <span class=\"token key atrule\">Path</span><span class=\"token punctuation\">:</span> /service<span class=\"token punctuation\">-</span>role/\n      <span class=\"token key atrule\">Policies</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">PolicyName</span><span class=\"token punctuation\">:</span> root\n          <span class=\"token key atrule\">PolicyDocument</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">Version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2012-10-17\"</span>\n            <span class=\"token key atrule\">Statement</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Effect</span><span class=\"token punctuation\">:</span> Allow\n                <span class=\"token key atrule\">Action</span><span class=\"token punctuation\">:</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"s3:GetObject\"</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"s3:GetObjectVersion\"</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"s3:GetBucketVersioning\"</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"s3:PutObject\"</span>\n                <span class=\"token key atrule\">Resource</span><span class=\"token punctuation\">:</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token tag\">!GetAtt</span> PipelineBucket.Arn\n                  <span class=\"token punctuation\">-</span> <span class=\"token tag\">!Join</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token tag\">!GetAtt</span> PipelineBucket.Arn<span class=\"token punctuation\">,</span> <span class=\"token string\">\"/*\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Effect</span><span class=\"token punctuation\">:</span> Allow\n                <span class=\"token key atrule\">Action</span><span class=\"token punctuation\">:</span>\n                  <span class=\"token punctuation\">-</span> ec2<span class=\"token punctuation\">:</span>DescribeSecurityGroups\n                  <span class=\"token punctuation\">-</span> ec2<span class=\"token punctuation\">:</span>DescribeNetworkInterfaces\n                  <span class=\"token punctuation\">-</span> ec2<span class=\"token punctuation\">:</span>DescribeSubnets\n                  <span class=\"token punctuation\">-</span> ec2<span class=\"token punctuation\">:</span>DescribeVpcs\n                  <span class=\"token punctuation\">-</span> ec2<span class=\"token punctuation\">:</span>DescribeDhcpOptions\n                  <span class=\"token punctuation\">-</span> ec2<span class=\"token punctuation\">:</span>CreateNetworkInterfacePermission\n                  <span class=\"token punctuation\">-</span> ec2<span class=\"token punctuation\">:</span>CreateNetworkInterface\n                  <span class=\"token punctuation\">-</span> ec2<span class=\"token punctuation\">:</span>DeleteNetworkInterfacePermission\n                  <span class=\"token punctuation\">-</span> ec2<span class=\"token punctuation\">:</span>DeleteNetworkInterface\n                  <span class=\"token punctuation\">-</span> logs<span class=\"token punctuation\">:</span>CreateLogGroup\n                  <span class=\"token punctuation\">-</span> logs<span class=\"token punctuation\">:</span>CreateLogStream\n                  <span class=\"token punctuation\">-</span> logs<span class=\"token punctuation\">:</span>PutLogEvents\n                <span class=\"token key atrule\">Resource</span><span class=\"token punctuation\">:</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"*\"</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Effect</span><span class=\"token punctuation\">:</span> Allow\n                <span class=\"token key atrule\">Action</span><span class=\"token punctuation\">:</span>\n                  <span class=\"token punctuation\">-</span> sts<span class=\"token punctuation\">:</span>AssumeRole\n                <span class=\"token key atrule\">Resource</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> AssumeRoleArn\n  <span class=\"token key atrule\">CodePipelineRole</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>IAM<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Role\n    <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">RoleName</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">\"Fn::Join\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"CodePipelineRole\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"-\"</span><span class=\"token punctuation\">,</span> <span class=\"token tag\">!Ref</span> <span class=\"token string\">\"AWS::StackName\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n      <span class=\"token key atrule\">AssumeRolePolicyDocument</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">Version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2012-10-17\"</span>\n        <span class=\"token key atrule\">Statement</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Effect</span><span class=\"token punctuation\">:</span> Allow\n            <span class=\"token key atrule\">Principal</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">Service</span><span class=\"token punctuation\">:</span>\n                <span class=\"token punctuation\">-</span> <span class=\"token string\">\"codepipeline.amazonaws.com\"</span>\n            <span class=\"token key atrule\">Action</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token string\">\"sts:AssumeRole\"</span>\n      <span class=\"token key atrule\">Policies</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">PolicyName</span><span class=\"token punctuation\">:</span> root\n          <span class=\"token key atrule\">PolicyDocument</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">Version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2012-10-17\"</span>\n            <span class=\"token key atrule\">Statement</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Effect</span><span class=\"token punctuation\">:</span> Allow\n                <span class=\"token key atrule\">Action</span><span class=\"token punctuation\">:</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"s3:GetObject\"</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"s3:GetObjectVersion\"</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"s3:GetBucketVersioning\"</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"s3:PutObject\"</span>\n                <span class=\"token key atrule\">Resource</span><span class=\"token punctuation\">:</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token tag\">!GetAtt</span> PipelineBucket.Arn\n                  <span class=\"token punctuation\">-</span> <span class=\"token tag\">!Join</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token tag\">!GetAtt</span> PipelineBucket.Arn<span class=\"token punctuation\">,</span> <span class=\"token string\">\"/*\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Fn::Sub</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"arn:aws:s3:::${SourceBucketName}*\"</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Fn::Sub</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"arn:aws:s3:::${SourceBucketName}/*\"</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Effect</span><span class=\"token punctuation\">:</span> Allow\n                <span class=\"token key atrule\">Action</span><span class=\"token punctuation\">:</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"codebuild:BatchGetBuilds\"</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"codebuild:StartBuild\"</span>\n                <span class=\"token key atrule\">Resource</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"*\"</span>\n  <span class=\"token key atrule\">DevCodeBuild</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"AWS::CodeBuild::Project\"</span>\n    <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">Name</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Sub</span> $<span class=\"token punctuation\">{</span>AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>StackName<span class=\"token punctuation\">}</span><span class=\"token punctuation\">-</span>dev<span class=\"token punctuation\">-</span>build\n      <span class=\"token key atrule\">Description</span><span class=\"token punctuation\">:</span> gatsby site build\n      <span class=\"token key atrule\">ServiceRole</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!GetAtt</span> CodeBuildRole.Arn\n      <span class=\"token key atrule\">Artifacts</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> CODEPIPELINE\n      <span class=\"token key atrule\">Environment</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">ComputeType</span><span class=\"token punctuation\">:</span> BUILD_GENERAL1_SMALL\n        <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> LINUX_CONTAINER\n        <span class=\"token key atrule\">Image</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"aws/codebuild/amazonlinux2-x86_64-standard:2.0\"</span>\n        <span class=\"token key atrule\">EnvironmentVariables</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Name</span><span class=\"token punctuation\">:</span> DISTRIBUTION_ID\n            <span class=\"token key atrule\">Value</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> DevDistributionID\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Name</span><span class=\"token punctuation\">:</span> DEPLOY_BUCKET_NAME\n            <span class=\"token key atrule\">Value</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> DevDeployBucketName\n      <span class=\"token key atrule\">Source</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> CODEPIPELINE\n        <span class=\"token key atrule\">BuildSpec</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"buildspec-dev.yaml\"</span>\n      <span class=\"token key atrule\">Tags</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Key</span><span class=\"token punctuation\">:</span> Technical<span class=\"token punctuation\">:</span>ApplicationName\n          <span class=\"token key atrule\">Value</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> ApplicationName\n\n  <span class=\"token key atrule\">ProdCodeBuild</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"AWS::CodeBuild::Project\"</span>\n    <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">Name</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Sub</span> $<span class=\"token punctuation\">{</span>AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>StackName<span class=\"token punctuation\">}</span><span class=\"token punctuation\">-</span>prod<span class=\"token punctuation\">-</span>build\n      <span class=\"token key atrule\">Description</span><span class=\"token punctuation\">:</span> gatsby site build\n      <span class=\"token key atrule\">ServiceRole</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!GetAtt</span> ProdCodeBuildRole.Arn\n      <span class=\"token key atrule\">Artifacts</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> CODEPIPELINE\n      <span class=\"token key atrule\">Environment</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">ComputeType</span><span class=\"token punctuation\">:</span> BUILD_GENERAL1_SMALL\n        <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> LINUX_CONTAINER\n        <span class=\"token key atrule\">Image</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"aws/codebuild/amazonlinux2-x86_64-standard:2.0\"</span>\n        <span class=\"token key atrule\">EnvironmentVariables</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Name</span><span class=\"token punctuation\">:</span> DISTRIBUTION_ID\n            <span class=\"token key atrule\">Value</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> ProdDistributionID\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Name</span><span class=\"token punctuation\">:</span> DEPLOY_BUCKET_NAME\n            <span class=\"token key atrule\">Value</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> ProdDeployBucketName\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Name</span><span class=\"token punctuation\">:</span> PROD_ROLE_ARN\n            <span class=\"token key atrule\">Value</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> AssumeRoleArn\n      <span class=\"token key atrule\">Source</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> CODEPIPELINE\n        <span class=\"token key atrule\">BuildSpec</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"buildspec-prod.yaml\"</span>\n      <span class=\"token key atrule\">Tags</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Key</span><span class=\"token punctuation\">:</span> Technical<span class=\"token punctuation\">:</span>ApplicationName\n          <span class=\"token key atrule\">Value</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> ApplicationName\n\n  <span class=\"token key atrule\">PipelineBucket</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"AWS::S3::Bucket\"</span>\n    <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">BucketName</span><span class=\"token punctuation\">:</span>\n        <span class=\"token tag\">!Join</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token tag\">!Ref</span> CodePipelineBucketPrefix<span class=\"token punctuation\">,</span> <span class=\"token string\">\"-\"</span><span class=\"token punctuation\">,</span> <span class=\"token tag\">!Ref</span> <span class=\"token string\">\"AWS::Region\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n      <span class=\"token key atrule\">Tags</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Key</span><span class=\"token punctuation\">:</span> Name\n          <span class=\"token key atrule\">Value</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Sub</span> $<span class=\"token punctuation\">{</span>CodePipelineBucketPrefix<span class=\"token punctuation\">}</span><span class=\"token punctuation\">-</span>pipeline\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Key</span><span class=\"token punctuation\">:</span> Technical<span class=\"token punctuation\">:</span>ApplicationName\n          <span class=\"token key atrule\">Value</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> ApplicationName\n\n<span class=\"token key atrule\">Outputs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">Pipeline</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Value</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> Pipeline\n  <span class=\"token key atrule\">DevCodeBuild</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Value</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> DevCodeBuild\n  <span class=\"token key atrule\">CodeBuildRole</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Value</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> CodeBuildRole\n  <span class=\"token key atrule\">CodePipelineRole</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Value</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> CodePipelineRole\n  <span class=\"token key atrule\">PipelineBucket</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Value</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> PipelineBucket</code></pre></div>\n<h2 id=\"build-spec-files\"><a href=\"#build-spec-files\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Build spec files</h2>\n<p>Build spec files provide instructions to the code build (how to build and deploy etc.).</p>\n<h3 id=\"buildspec-devyml\"><a href=\"#buildspec-devyml\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>buildspec-dev.yml</h3>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0.2</span>\n<span class=\"token key atrule\">phases</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">install</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runtime-versions</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">nodejs</span><span class=\"token punctuation\">:</span> <span class=\"token number\">12</span>\n  <span class=\"token key atrule\">pre_build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">commands</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> echo Installing source NPM dependencies<span class=\"token punctuation\">...</span>\n      <span class=\"token punctuation\">-</span> node <span class=\"token punctuation\">-</span>v\n      <span class=\"token punctuation\">-</span> npm <span class=\"token punctuation\">-</span>v\n      <span class=\"token punctuation\">-</span> npm install\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">commands</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> echo Dev Build started on `date`\n      <span class=\"token punctuation\">-</span> npm run build\n  <span class=\"token key atrule\">post_build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">commands</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> aws s3 rm <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>recursive s3<span class=\"token punctuation\">:</span>//$<span class=\"token punctuation\">{</span>DEPLOY_BUCKET_NAME<span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">-</span> cd public &amp;&amp; aws s3 sync . s3<span class=\"token punctuation\">:</span>//$<span class=\"token punctuation\">{</span>DEPLOY_BUCKET_NAME<span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">-</span> aws cloudfront create<span class=\"token punctuation\">-</span>invalidation <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>distribution<span class=\"token punctuation\">-</span>id $<span class=\"token punctuation\">{</span>DISTRIBUTION_ID<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>paths \"/*\"\n<span class=\"token key atrule\">artifacts</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">files</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token string\">'**/*'</span>\n  <span class=\"token key atrule\">base-directory</span><span class=\"token punctuation\">:</span> public</code></pre></div>\n<h3 id=\"buildspec-prodyml\"><a href=\"#buildspec-prodyml\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>buildspec-prod.yml</h3>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0.2</span>\n<span class=\"token key atrule\">phases</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">install</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runtime-versions</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">nodejs</span><span class=\"token punctuation\">:</span> <span class=\"token number\">12</span>\n  <span class=\"token key atrule\">pre_build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">commands</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> echo Installing source NPM dependencies<span class=\"token punctuation\">...</span>\n      <span class=\"token punctuation\">-</span> node <span class=\"token punctuation\">-</span>v\n      <span class=\"token punctuation\">-</span> npm <span class=\"token punctuation\">-</span>v\n      <span class=\"token punctuation\">-</span> npm install\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">commands</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> echo Prod Build started on `date`\n      <span class=\"token punctuation\">-</span> npm run build\n      <span class=\"token punctuation\">-</span> chmod +x ./scripts/assume<span class=\"token punctuation\">-</span>role.sh\n      <span class=\"token punctuation\">-</span> ./scripts/assume<span class=\"token punctuation\">-</span>role.sh $<span class=\"token punctuation\">{</span>PROD_ROLE_ARN<span class=\"token punctuation\">}</span> prod\n  <span class=\"token key atrule\">post_build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">commands</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> aws s3 rm <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>recursive s3<span class=\"token punctuation\">:</span>//$<span class=\"token punctuation\">{</span>DEPLOY_BUCKET_NAME<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>profile prod\n      <span class=\"token punctuation\">-</span> cd public\n      <span class=\"token punctuation\">-</span> aws s3 sync . s3<span class=\"token punctuation\">:</span>//$<span class=\"token punctuation\">{</span>DEPLOY_BUCKET_NAME<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>profile prod\n      <span class=\"token punctuation\">-</span> aws cloudfront create<span class=\"token punctuation\">-</span>invalidation <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>profile prod <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>distribution<span class=\"token punctuation\">-</span>id $<span class=\"token punctuation\">{</span>DISTRIBUTION_ID<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>paths \"/*\"\n<span class=\"token key atrule\">artifacts</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">files</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token string\">'**/*'</span>\n  <span class=\"token key atrule\">base-directory</span><span class=\"token punctuation\">:</span> public</code></pre></div>\n<h2 id=\"script-to-deploy-in-prod-account\"><a href=\"#script-to-deploy-in-prod-account\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Script to deploy in prod account</h2>\n<p>Insert this script inside a /script folder from your root folder.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\nROLE_ARN<span class=\"token operator\">=</span><span class=\"token variable\">$1</span>\nOUTPUT_PROFILE<span class=\"token operator\">=</span><span class=\"token variable\">$2</span>\n\n<span class=\"token keyword\">echo</span> <span class=\"token string\">\"Assuming role <span class=\"token variable\">$ROLE_ARN</span>\"</span>\nsts<span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>aws sts assume-role \\\n  --role-arn <span class=\"token string\">\"<span class=\"token variable\">$ROLE_ARN</span>\"</span> \\\n  --role-session-name <span class=\"token string\">\"<span class=\"token variable\">$OUTPUT_PROFILE</span>\"</span> \\\n  --query <span class=\"token string\">'Credentials.[AccessKeyId,SecretAccessKey,SessionToken]'</span> \\\n  --output text<span class=\"token variable\">)</span></span>\n<span class=\"token keyword\">echo</span> <span class=\"token string\">\"Converting sts to array\"</span>\nsts<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$sts</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">echo</span> <span class=\"token string\">\"AWS_ACCESS_KEY_ID is <span class=\"token variable\">${sts[0]}</span>\"</span>\naws configure <span class=\"token keyword\">set</span> aws_access_key_id <span class=\"token variable\">${sts[0]}</span> --profile <span class=\"token variable\">$OUTPUT_PROFILE</span>\naws configure <span class=\"token keyword\">set</span> aws_secret_access_key <span class=\"token variable\">${sts[1]}</span> --profile <span class=\"token variable\">$OUTPUT_PROFILE</span>\naws configure <span class=\"token keyword\">set</span> aws_session_token <span class=\"token variable\">${sts[2]}</span> --profile <span class=\"token variable\">$OUTPUT_PROFILE</span>\n<span class=\"token keyword\">echo</span> <span class=\"token string\">\"credentials stored in the profile named <span class=\"token variable\">$OUTPUT_PROFILE</span>\"</span></code></pre></div>\n<p>This script will assume the role from the prod account and deploy changes into the prod account.</p>\n<h2 id=\"manually-create-assume-role-in-the-prod-account\"><a href=\"#manually-create-assume-role-in-the-prod-account\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Manually create Assume role in the Prod account</h2>\n<p>Next, we should manually create a role. When you create the role add this as an inline policy.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">    <span class=\"token property\">\"Version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2012-10-17\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"Statement\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token string\">\"s3:ListAllMyBuckets\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"s3:ListBucket\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"s3:HeadBucket\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"s3:GetObject\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"s3:GetObjectVersion\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"s3:GetBucketVersioning\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"s3:PutObject\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"s3:PutObjectAcl\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"s3:ListObjectsV2\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"s3:DeleteObject\"</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Resource\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token string\">\"arn:aws:s3:::&lt;prod-bucket-name>\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"arn:aws:s3:::&lt;prod-bucket-name>/*\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Allow\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token string\">\"logs:CreateLogGroup\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"logs:CreateLogStream\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"logs:PutLogEvents\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"cloudfront:CreateInvalidation\"</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Resource\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token string\">\"*\"</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Allow\"</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Then under trust relationships add this JSON to enable assume your role from dev account.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"Version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2012-10-17\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"Statement\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Allow\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Principal\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"AWS\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"arn:aws:iam::&lt;dev account>:root\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"sts:AssumeRole\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Condition\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>   </code></pre></div>\n<p>Now everything is set to test. Try to trigger the pipeline by a code merge to see the magic happens.</p>\n<h1 id=\"references\"><a href=\"#references\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>References</h1>\n<ol>\n<li><a href=\"https://aws.amazon.com/blogs/devops/integrating-git-with-aws-codepipeline/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"></a></li>\n</ol>","timeToRead":8,"frontmatter":{"title":"How to use AWS code pipeline to deploy a Static Website into S3","date":"May 01, 2020","spoiler":"The one with Gatsby site deployment pipeline","author":"Nadun Indunil","tags":["gatsby","AWS","react","S3"]},"fields":{"slug":"/gatsby-pipeline/","langKey":"en"}}},"pageContext":{"slug":"/gatsby-pipeline/","previous":{"fields":{"slug":"/localstack/","langKey":"en","directoryName":"localstack"},"frontmatter":{"title":"Using Localstack to mimic AWS resources in local development","tags":["AWS","architecture","nodejs","docker"]}},"next":null,"translations":[],"translatedLinks":[]}}