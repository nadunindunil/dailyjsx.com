{"data":{"site":{"siteMetadata":{"title":"DailyJSX","author":"Nadun Indunil"}},"markdownRemark":{"id":"c67bc0a7-4dd5-5877-a2c9-2b89c4600f00","html":"<p>Have you ever come across an issue of using AWS resources in the development environment? I bet most of you have faced it. This issue might look much simpler and you might have used the existing AWS resource to carry on your local development. But, did you think about a way to solve this issue when testing happens on top of your framework or application?</p>\n<p>Recently, when I was developing a node.js project I found an interesting platform named (<a href=\"https://github.com/localstack/localstack\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">LocalStack</a>) which helped us to mimic AWS resources. This made our lives easier when not only testing our application but also application development.</p>\n<p>Other than easy to test application, you can gain these benefits from Localstack,</p>\n<ol>\n<li>No need to pay for AWS usage for your local development.</li>\n<li>No need to log in to the AWS console.</li>\n<li>Separate development ENV so everything under your control. (you can create and delete resources easily)</li>\n<li>No sharing and getting problems from other developers since it’s separated. ☺️</li>\n<li>It’s full offline.</li>\n</ol>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9ee5b1deddf2c483fae3a857b7045738/869e4/localstack.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 40.33722438391699%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABVElEQVQoz3VSa0vDQBDM//9NxVpBsX7QPmgp2lowtkkkTa55Xu417m3SoqALw3I7u7M3lwRVVUF2HTpFoCylZHRKwVhDNcV15hg9p5TqOco8Q5zXCnwjyhAqWkDHM6DNAFXBJEvI4xw2ewOHkXDpGuZrBXfawFkNV3zQzAImXhIvEMUJAq+O7BX5ZoxmNwHqBOgKtPt7pOsRdPTSC+oW9jBFs3+Ai55JQAH5FtXujnvRxkizfBAcQluyZskS3cZYxTVLttVgyzkLuhrxLRT1Slri0Nd8pGn6W3CfvmM0G2GyusVnHvZLtEZZliiKgs+KFj1tpxjPbzDdPqJRDQn282EYIvDbL1HIM47iwKi6En+FobdLihiROHLW3vogWNf18FHYmkV2yhg5vYUQguvOuSsu53N+5j6RC56zg2W+YdM010al+9/BZ2/1P0HP+T6ff3Je6xu2vGnJqAINCQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"localstack in different environment\"\n        title=\"\"\n        src=\"/static/9ee5b1deddf2c483fae3a857b7045738/40fad/localstack.png\"\n        srcset=\"/static/9ee5b1deddf2c483fae3a857b7045738/707e9/localstack.png 148w,\n/static/9ee5b1deddf2c483fae3a857b7045738/649e0/localstack.png 295w,\n/static/9ee5b1deddf2c483fae3a857b7045738/40fad/localstack.png 590w,\n/static/9ee5b1deddf2c483fae3a857b7045738/b3fef/localstack.png 885w,\n/static/9ee5b1deddf2c483fae3a857b7045738/301c0/localstack.png 1180w,\n/static/9ee5b1deddf2c483fae3a857b7045738/869e4/localstack.png 1542w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    \n<em>Fig. 1: A diagram of the Localstack usage in test/dev environment</em></p>\n<p>So how would someone use Localstack with their application?\nLet’s discuss this step by step.</p>\n<p>There are multiple ways to start Localstack in your machine, but I would prefer the Docker included way because it’s more cleaner and easier than other ways. (This might depend on the docker knowledge you and your team possess)</p>\n<p>Refer this link for other methods to start Localstack: <a href=\"https://github.com/localstack/localstack\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/localstack/localstack</a></p>\n<p>The following example will be using node.js with Docker to build a backend. But please note that Localstack is not limited to node.js nor Docker technologies. However, If you are following the same stack I do, You won’t have to change much in your codebase.</p>\n<ol>\n<li>Prepare your docker-compose file to cater the localstack</li>\n<li>How to create resources locally</li>\n<li>Code changes in node.js application</li>\n</ol>\n<h3 id=\"preparing-your-docker-compose-file\"><a href=\"#preparing-your-docker-compose-file\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Preparing your docker-compose file</h3>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\">version: &quot;3&quot;\nservices:\n  app:\n    image: node:alpine\n    volumes:\n      - ./:/app\n    working_dir: /app\n    depends_on:\n      - mongo\n    environment:\n      NODE_ENV: development\n      URL: mongo\n      PORT: 27017\n    ports:\n      - 3001:3001\n    links:\n      - mongo:mongo\n      - localstack:localstack\n    command: npm run dev\n  ...\n  localstack:\n    image: localstack/localstack:latest\n    container_name: localstack_container\n    ports:\n      - &#39;4563-4599:4563-4599&#39;\n      - &#39;8055:8080&#39;\n    environment:\n      - SERVICES=s3\n      - DEBUG=1\n      - DATA_DIR=/tmp/localstack/data\n    volumes:\n      - &#39;./.localstack:/tmp/localstack&#39;\n      - &#39;/var/run/docker.sock:/var/run/docker.sock&#39;</code></pre></div>\n<p>There are a few things you need to consider when writing the docker-compose file. </p>\n<ol>\n<li>You should include <code class=\"language-text\">localstack</code> as a link under your application. (please observe the example above)</li>\n<li>I have provided <code class=\"language-text\">SERVICES=s3</code> as env variables under the localstack. That means this docker instance going to mimic functionality of an AWS S3.</li>\n<li>Note that ports range I have enabled under localstack. <code class=\"language-text\">&#39;4563-4599:4563-4599&#39;</code> is for service mimic ports. <code class=\"language-text\">&#39;8055:8080&#39;</code> for localstack dashboard.</li>\n</ol>\n<p>you can find more information here: <a href=\"https://github.com/localstack/localstack\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/localstack/localstack</a></p>\n<p>Now that we have crafted the docker-composer, lets run our docker instances. use</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">docker-compose up -d</code></pre></div>\n<p>to run docker instances.</p>\n<h2 id=\"create-resources-locally\"><a href=\"#create-resources-locally\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create resources locally</h2>\n<p>run </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">aws --endpoint-url=http://localhost:4572 s3 mb s3://test-app-develop\naws --endpoint-url=http://localhost:4572 s3api put-bucket-acl --bucket test-app-develop --acl public-read</code></pre></div>\n<p>in your console.</p>\n<p>This will create an S3 bucket named <code class=\"language-text\">test-app-develop</code> and bucket ACL (public-read) respectively.</p>\n<h2 id=\"code-changes-in-nodejs-application\"><a href=\"#code-changes-in-nodejs-application\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Code changes in node.js application</h2>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// useLocal = is app running in development</span>\n\nconfig<span class=\"token punctuation\">.</span>s3 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  region<span class=\"token punctuation\">:</span> <span class=\"token string\">'us-east-1'</span><span class=\"token punctuation\">,</span>\n  endpoint<span class=\"token punctuation\">:</span> useLocal <span class=\"token operator\">?</span> <span class=\"token string\">'http://localstack:4572'</span> <span class=\"token punctuation\">:</span> undefined<span class=\"token punctuation\">,</span>\n  credentials<span class=\"token punctuation\">:</span> useLocal\n    <span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span>\n        accessKeyId<span class=\"token punctuation\">:</span> <span class=\"token string\">'123'</span><span class=\"token punctuation\">,</span>\n        secretAccessKey<span class=\"token punctuation\">:</span> <span class=\"token string\">'xyz'</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">:</span> undefined<span class=\"token punctuation\">,</span>\n  s3ForcePathStyle<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> s3 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AWS<span class=\"token punctuation\">.</span>S3</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span>s3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol>\n<li>useLocal is a flag I used to determine running app env. This will help us to toggle S3 config depend on the env.</li>\n<li>It is important to use <code class=\"language-text\">http://localstack:4572</code> as S3 endpoint. It is not <code class=\"language-text\">http://localhost:4572</code> because of Localstack running inside a Docker container.</li>\n<li>You may find that I have added dummy credentials, That is because we cannot leave it empty. But You can be more creative and find an elegant way. (without dummy details in code)</li>\n</ol>\n<h2 id=\"references\"><a href=\"#references\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>References</h2>\n<ol>\n<li><a href=\"https://github.com/localstack/localstack\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/localstack/localstack</a></li>\n<li><a href=\"https://github.com/good-idea/localstack-demo\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/good-idea/localstack-demo</a></li>\n<li><a href=\"https://dev.to/goodidea/how-to-fake-aws-locally-with-localstack-27me\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://dev.to/goodidea/how-to-fake-aws-locally-with-localstack-27me</a></li>\n</ol>","timeToRead":4,"frontmatter":{"title":"Using Localstack to mimic AWS resources in local development","date":"March 29, 2020","spoiler":"The one with mocking AWS resources locally","author":"Nadun Indunil","tags":["AWS","architecture","nodejs","docker"]},"fields":{"slug":"/localstack/","langKey":"en"}}},"pageContext":{"slug":"/localstack/","previous":{"fields":{"slug":"/micro-frontends/","langKey":"en","directoryName":"micro-frontends"},"frontmatter":{"title":"Introduction to Micro Frontends","tags":["micro-fe","architecture"]}},"next":null,"translations":[],"translatedLinks":[]}}